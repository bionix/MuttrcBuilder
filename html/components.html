<%once>
# Who runs this muttrcbuilder instance?
our $MAINTAINER = [ "Luke Ross" => 'http://lukeross.name/' ];
</%once>
<%method page>
<%args>
  $style => "" # Optional extra CSS styling needed for this page
</%args>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <title>muttrc builder</title>
    <meta http-equiv="Content-Type"
      content="text/html; charset=iso-8859-1" />
    <link href="style.css" type="text/css" rel="stylesheet" />
% if ($style) {
    <style type="text/css">
<% $style %>
    </style>
% }
  </head>
  <body>
    <h1>muttrc builder</h1>
% # Render inner component
<% $m->content() %>
    <address>
      Service provided by
        <a href="<% $MAINTAINER->[1] %>"><% $MAINTAINER->[0] %></a>.
    </address>
  </body>
</html>
</%method>
<%method page_chooser>
% # Render the page-change drop-down at the top of each page
  <%args>
     $mutt         # Mutt::Config object to operate on
     $current_page # What page are we on now?
  </%args>
    <hr />
    <p>
      <strong>Change page:</strong>
      <select name="page">
% foreach my $p (sort $mutt->categories()) { # Possible pages
        <option <% ($p eq $current_page) ?
          "selected='selected'" : "" %>><% $p %></option>
% }
        <option value="_color" <% ($current_page eq "_color") ?
          "selected='selected'" : "" %>>color</option>
        <option value="_finish">FINISH &amp; BUILD MUTTRC</option>
      </select>
      <input type="submit" value="Change" /><br />
      Once you're done, select <tt>finish &AMP; build muttrc</tt> from
      the list above.
    </p>
    <hr />
</%method>
<%method copy_over_hidden_fields>
% # The builder uses post fields to keep track of info - this routine
% # keeps the fields from previous screens
<%args>
  $args # The %ARGS of the caller
  $mutt # The Mutt::Config object in use
  $page # The page we're rendering now (to avoid dupe fields)
</%args>
<input type="hidden" name="version" value="<% $args->{version} | h %>" />
% while(my($k, $v) = each %$args) {
%   next if ($k !~ m/^(opt|col)_([a-z0-9_]{1,50})$/);
%   # We mustn't duplicate fields or we get arrays in response
%   next if ($1 eq "opt" and $mutt->variable($2)->category() eq $page);
%   next if ($1 eq "col" and $page eq "_color");
<input type="hidden" name="<% $k %>" value="<% $v | h %>" />
% }
</%method>
